# Config

The library that contains configuration information for a Telcoin Network node.

## Purpose & Scope

The config crate contains various configuration parameters that allow a node to participate with the protocol.
It contains sensitive information and manages private keys.

## Key Components

### ConsensusConfig

The configuration for consensus layer.
The `Committee` and `WorkerCache` contains all information for committee participates that vote to extend the canonical tip.
The committee is comprised of staked validators and information to verify their communication.

### GenesisConfig

The configuration for network genesis.
This is only used once, at the network's genesis.
The initial committee is generated by a "Master of Ceremony" using a centralized VCS (ie - GitHub).
Each validator must submit a proof-of-possession, which is validated using this logic.

See `bin/telcoin-network/genesis` for more information on how this is used.

### KeyConfig

The most critical config for a node.
This contains the node's keys used to authenticate protocol messages.

The protocol requires access to three keys in the current version:

- Primary BLS12-381 key
- Primary Ed25519 network key
- Worker Ed25519 network key (only support 1 worker per node for now)

Node operators can generate BLS keys using the CLI (see bin/telcoin-network/keytool).
The generated keys are stored on the filesystem using AES-GCM-SIV.
This config contains the logic for ensuring appropriate encryption.

The network keys are deterministically derived from a bls signature of a seed string.

Signatures are requested using the trait `tn_types::crypto::BlsSigner`.
The method `request_signature_direct` is used when publishing node records to the kademlia store in `network-libp2p/src/consensus.rs` and when the primary node votes on a header in `types/src/primary/vote.rs`.
The goal is to keep private keys in memory and provide a secure API for obtaining signatures rapidly.

## Security Considerations

### Threat Models

#### Key Management

Keys are paramount for security.

#### Invalid Transactions

Transactions are suppose to extend the canonical tip.
The `BatchValidator` attempts to retrieve the batch's canonical header from the database, but uses its own finalized header as a fallback.
Transactions may revert at execution, but this is considered a non-fatal error handled by `tn-engine`.

### Trust Assumptions

- Network keys are generated securely as long as the node operator treats their BLS signature of the seed phrase as a password

### Critical Invariants

- Batches are intentionally designed to be agnostic (transactions are `Vec<Vec<u8>>`) so the network can support different execution environments in future versions
- The engine gracefully ignores invalid transactions
- Basefees only adjust at the start of a new epoch
- Batch validators are only valid within a single epoch

## Dependencies & Interfaces

### Dependencies

- **Worker**: Source of batches to validate
- **Canonical Chain State**: Current canonical tip updates from `tn-engine`
- **Epoch Management**: Basefee and epoch information

### Interfaces

- **Owned by Worker**: Each worker owns an instance of a `BatchValidator`. Workers only support one execution environment and one basefee.
